## Legacy C Refactoring

### cppcheck
basic usage
```bash
$ cppcheck grep.c
```

### useful options
* --check-level=reduced | normal(default) | exhaustive
* --dump
* --enable=all | warning | style | performance | portability | information | unusedFunction | missingInclude
* -j <jobs>
* --language=c | c++
* --output-file=<file>
* --output-format=text | sarif | xml
* --platform=unix32 | unix62 | win32A | win32W | win64 ..
* --report-type=normal | autosar | cert-c-2016 | misra-c-2012 | ...
* --showtime=summary | ...
* --std=c89 | c99 | c11 | ...

### Example
```bash
$ cppcheck grep.c -j 8 --language=c -I libcommon/ -I libuxre/ --output-file=cppcheck-report.xml --output-format=xml --enable=all
```

```bash
$ cppcheck grep.c -j 8 \
--language=c \
-I libcommon/ \
-I libuxre/ \
--check-level=exhaustive \
--output-file=cppcheck-report.txt \
--output-format=text \
--template='{file}:{line},{severity},{id},{message}' \
--enable=warning
```

Check out the result
```
grep.c:268,warning,invalidPrintfArgType_uint,%llu in format string (no. 1) requires 'unsigned long long' but the argument type is 'signed long long'.
grep.c:270,warning,invalidPrintfArgType_uint,%llu in format string (no. 1) requires 'unsigned long long' but the argument type is 'signed long long'.
grep.c:472,warning,invalidPrintfArgType_uint,%llu in format string (no. 1) requires 'unsigned long long' but the argument type is 'signed long long'.
grep.c:545,warning,nullPointerOutOfMemory,If memory allocation fails, then there is a possible null pointer dereference: path
grep.c:546,warning,nullPointerOutOfMemory,If memory allocation fails, then there is a possible null pointer dereference: path
grep.c:490,error,uninitvar,Uninitialized variable: &st
```

"grep.c:545,warning,nullPointerOutOfMemory,If memory allocation fails, then there is a possible null pointer dereference: path"

**grep.c**
```c
    path = malloc(psize = pend + 2);
    strcpy(path, fn);      // line 545
    path[pend++] = '/';    // line 546
```

"grep.c:490,error,uninitvar,Uninitialized variable: &st"

```c
/* stat.h */
int stat(const char *, struct stat *) __DARWIN_INODE64(stat);

/* grep.c */
int	(*rflag)(const char *, struct stat *);

static void
fngrep(const char *fn, int level)
{
  struct stat	st; 
  if (rflag && fn && (level ? rflag : stat)(fn, &st) == 0) {
    //...
  }
}
```

```bash
$ cppcheck grep.c -j 8 \
--language=c \
-I libcommon/ \
-I libuxre/ \
--check-level=exhaustive \
--output-file=cppcheck-perf-report.txt \
--output-format=text \
--template='{file}:{line},{severity},{id},{message}' \
--enable=performance
```